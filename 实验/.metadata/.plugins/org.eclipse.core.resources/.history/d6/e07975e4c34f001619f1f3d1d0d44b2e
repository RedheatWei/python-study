#!/usr/bin/env python
#_*_ coding:utf-8 _*_
'''
Created on 2016年7月22日
Email: weipeng@sinashow.com
@author: Redheat

'''
import zipfile
from ftplib import FTP
##########conf##########
ftp_server='' #ftp地址
username='' #ftp用户名
password='' #ftp密码
zipfilename = '' #压缩后的文件名
uploadpath = '' #上传文件路径
ftp_reconnect = 3 #ftp失败重连次数
######################
def createFileList():
    filenamelist = []
    return filenamelist

def zipFile(filenamelist):
    z = zipfile.ZipFile(zipfilename, 'w')
    for filename in filenamelist:
        z.write(filename)
    z.close()
    print "zip file success!"
def ftpconnect():
    ftp=FTP()  
    ftp.set_debuglevel(2) #打开调试级别2，显示详细信息  
    try: 
        ftp.connect(ftp_server,21) #连接  
        ftp.login(username,password) #登录，如果匿名登录则用空串代替即可  
    except Exception,e:
        print "Error: %s .ftp connect faild!" % e
        return 0
    else:
        print "connect ftp success!"
        return ftp
def uploadfile(ftp): 
    bufsize = 1024
    try:
        fp = open(zipfilename,'rb')  
        ftp.storbinary('STOR '+ uploadpath ,fp,bufsize) #上传文件
        ftp.set_debuglevel(0)
        fp.close() #关闭文件  
        ftp.quit()
    except Exception,e:
        print "Error:%s."

def main():
    filenamelist = createFileList()
    for i in range(1,ftp_reconnect+1):
        ftp = ftpconnect()
        if ftp != 0:
            zipfile(filenamelist)
            uploadfile(ftp)
            exit(0)
        else:
            print 'connect ftp faild %s!' % i
if __name__ == '__main__':
    main()
        
        
        
